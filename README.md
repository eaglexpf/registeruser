# registeruser

## 项目目录
```cassandraql
├─api              接口层
├─entity           实体
│   ├─response
│   └─request
├─middleware
├─model
├─service
└─util
```

## 基础后台框架
1. 用户的注册，登录，退出，修改基本信息和密码

## api保护
1. 用户登录后将用户uuid作为主键存入redis的hash中；相当于构建了一个session
2. session默认两小时过期；有用户请求的话则重置过期时间
3. 用户登录后生成的jwt也存入用户的sesion中；同时只会存在一个jwt，刷新新的jwt会替换掉旧的
4. 用户使用其他api服务时校验jwt是否存在session中；不存在则提醒用户账号处于危险状态，有被盗用的风险

## 待办事项
1. log日志直接写入kafka和es
2. viper从etcd和consul读取配置信息


## job 任务
### 接受服务
1. 接受任务请求【请求体包含：地址，参数，执行超时时间，执行时间】
2. 生成uuid，将uuid和数据包存入hash
3. 将任务的执行时间改成时间戳和uuid压入redis有序集合内
### 中继服务
1. 主进程每秒唤醒一次
2. 读取有序集合内所有小于等于当前时间戳的uuid
3. 将uuid压入唯一集合内，保障执行服务只执行一次
4. ~~向订阅频道发送有执行任务的消息【redis的订阅服务并不可靠】~~
5. 将uuid压入临时列表内【读取临时列表并判断是否在唯一集合内】
### 执行服务
1. ~~订阅消息频道~~
2. ~~接受订阅消息后执行异步任务，将唯一集合内的id压入列表~~
3. 从列表读取uuid并判断唯一集合内是否有该id，没有直接抛弃
4. 从hash中读取uuid对应的数据
5. 执行数据对应的任务
6. 执行成功后删除hash中对应的uuid数据
7. 超时或失败后修改hash中的执行次数并将uuid重新压入有序集合内，分数为当前时间戳加上2的执行次数的次方
8. 执行完毕后判断list中是否还有数据，没有的话关闭异步进程，有的话从3执行